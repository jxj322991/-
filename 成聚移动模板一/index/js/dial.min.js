
        var canvas = document.getElementById('canvas');
var ctx = canvas.getContext('2d');

var canvasWidth = $('.canvas').width();
var canvasHeight = $('.canvas').height();
canvas.setAttribute('width', canvasWidth + 'px');
canvas.setAttribute('height', canvasHeight + 'px');

var initObj = {};
initObj.index = 0;
initObj.timer = null;
 initObj.deg = Math.PI / 180;
 initObj.running = false; // 是否运行中
 initObj.speed = 300; // 速度
initObj.isBeginPrize = false; // 是否开始抽奖
 initObj.stepping = 0; // 步数，经过一个扇形为1步
 initObj.baseCircle = 4; // 点击开始时，圆盘旋转的圈数，旋转玩指定圈数之后，再根据selected的值确定奖项
 initObj.selected = 0;

pin = new Image();
pin.src = 'img/new_pin.png'; 

ctx.translate(canvas.width / 2, canvas.height / 2);

function drawPin() {
    ctx.clearRect(-canvas.width / 2, -canvas.height / 2, canvas.width, canvas.height);
    ctx.drawImage(pin, 0, -253);
    ctx.rotate(Math.PI / 180 * 45);

    // var cx = canvasWidth / 2; // 圆心
    // var cy = canvasHeight / 2;// 圆心
    // var radius = 0.86 * canvasWidth / 2;// 半径
    // var startAngle = initObj.index * 45;
    // var endAngle = startAngle + 44;
    // var grad = ctx.createRadialGradient(cx, cy, 1, cx, cy, radius);
    // grad.addColorStop(0, "rgba(254,141,30,0.01)");
    // grad.addColorStop(1, "rgba(254,141,30,1)");
    // ctx.fillStyle = grad;
    // // 绘制扇形
    // ctx.beginPath();
    // ctx.moveTo(cx, cy);
    // ctx.arc(cx, cy, radius, initObj.deg * startAngle, initObj.deg * endAngle, false);
    // ctx.lineTo(cx, cy);
    // ctx.fill();
}

function clearTimer() {
    clearInterval(initObj.timer);
    initObj.timer = null;
}

// 初始化抽奖参数
function init() {
    initObj.baseCircle = 4;
    initObj.selected = 0; // 最终选中第几个扇形，也就是确定几等奖
    initObj.running = false;
    initObj.isBeginPrize = false;
    initObj.index = initObj.index++;
    initObj.stepping = 0;
    initObj.speed = 300;
}
function spinPlate() {
    if (initObj.stepping == 4) { // 4步之后开始加速
        clearTimer();
        initObj.speed = 80;
        initObj.timer = setInterval(spinPlate, initObj.speed);
    }

    if (initObj.baseCircle > 0 && initObj.index == 8) { // 基本圈数结束以后，开始随机抽奖
        initObj.index = 0;
        initObj.baseCircle--;
        if (initObj.baseCircle == 0) { // 开始随机抽奖
            clearTimer();
            initObj.speed = 280;
            initObj.timer = setInterval(spinPlate, initObj.speed);
            initObj.isBeginPrize = true;
        }

    }

    if (initObj.isBeginPrize && initObj.selected > 0) { // 开始抽奖
        if (--initObj.selected == 0) { //到了选择的奖项之后
            clearTimer();
            initObj.running = false;
        }
        else {
            clearTimer();
            initObj.speed += 60;
            initObj.timer = setInterval(spinPlate, initObj.speed);
        }
    }

    drawPin();
    initObj.index++;
    initObj.stepping++;
}

$('#turnPlatebtn').click(function () {
$('#turnPlatebtn').toggleClass('disabled');
    init();
    initObj.selected = 6;
     initObj.timer = setInterval(spinPlate, initObj.speed);
})